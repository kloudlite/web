import{r as e}from"./index-76fb7be0.js";import{u as K,a as $}from"./use-force-update-d6d40804.js";import{a as A,P as O,L as U,u as F}from"./motion-e61dcc0d.js";class B extends e.Component{getSnapshotBeforeUpdate(i){const t=this.props.childRef.current;if(t&&i.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function T({children:s,isPresent:i}){const t=e.useId(),n=e.useRef(null),m=e.useRef({width:0,height:0,top:0,left:0});return e.useInsertionEffect(()=>{const{width:p,height:l,top:f,left:h}=m.current;if(i||!n.current||!p||!l)return;n.current.dataset.motionPopId=t;const a=document.createElement("style");return document.head.appendChild(a),a.sheet&&a.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${l}px !important;
            top: ${f}px !important;
            left: ${h}px !important;
          }
        `),()=>{document.head.removeChild(a)}},[i]),e.createElement(B,{isPresent:i,childRef:n,sizeRef:m},e.cloneElement(s,{ref:n}))}const P=({children:s,initial:i,isPresent:t,onExitComplete:n,custom:m,presenceAffectsLayout:p,mode:l})=>{const f=A(b),h=e.useId(),a=e.useMemo(()=>({id:h,initial:i,isPresent:t,custom:m,onExitComplete:r=>{f.set(r,!0);for(const u of f.values())if(!u)return;n&&n()},register:r=>(f.set(r,!1),()=>f.delete(r))}),p?void 0:[t]);return e.useMemo(()=>{f.forEach((r,u)=>f.set(u,!1))},[t]),e.useEffect(()=>{!t&&!f.size&&n&&n()},[t]),l==="popLayout"&&(s=e.createElement(T,{isPresent:t},s)),e.createElement(O.Provider,{value:a},s)};function b(){return new Map}function D(s){return e.useEffect(()=>()=>s(),[])}const d=s=>s.key||"";function G(s,i){s.forEach(t=>{const n=d(t);i.set(n,t)})}function H(s){const i=[];return e.Children.forEach(s,t=>{e.isValidElement(t)&&i.push(t)}),i}const _=({children:s,custom:i,initial:t=!0,onExitComplete:n,exitBeforeEnter:m,presenceAffectsLayout:p=!0,mode:l="sync"})=>{const f=e.useContext(U).forceRender||K()[0],h=$(),a=H(s);let r=a;const u=e.useRef(new Map).current,x=e.useRef(r),E=e.useRef(new Map).current,g=e.useRef(!0);if(F(()=>{g.current=!1,G(a,E),x.current=r}),D(()=>{g.current=!0,E.clear(),u.clear()}),g.current)return e.createElement(e.Fragment,null,r.map(o=>e.createElement(P,{key:d(o),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:p,mode:l},o)));r=[...r];const R=x.current.map(d),w=a.map(d),L=R.length;for(let o=0;o<L;o++){const c=R[o];w.indexOf(c)===-1&&!u.has(c)&&u.set(c,void 0)}return l==="wait"&&u.size&&(r=[]),u.forEach((o,c)=>{if(w.indexOf(c)!==-1)return;const M=E.get(c);if(!M)return;const k=R.indexOf(c);let y=o;if(!y){const v=()=>{u.delete(c);const z=Array.from(E.keys()).filter(C=>!w.includes(C));if(z.forEach(C=>E.delete(C)),x.current=a.filter(C=>{const I=d(C);return I===c||z.includes(I)}),!u.size){if(h.current===!1)return;f(),n&&n()}};y=e.createElement(P,{key:d(M),isPresent:!1,onExitComplete:v,custom:i,presenceAffectsLayout:p,mode:l},M),u.set(c,y)}r.splice(k,0,y)}),r=r.map(o=>{const c=o.key;return u.has(c)?o:e.createElement(P,{key:d(o),isPresent:!0,presenceAffectsLayout:p,mode:l},o)}),e.createElement(e.Fragment,null,u.size?r:r.map(o=>e.cloneElement(o)))};export{_ as A};
